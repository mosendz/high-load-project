# Выбор и реализация свойств из CAP-теоремы

В соответствии с CAP-теоремой распределённые системы можно разделить на 3 вида, каждый из которых обеспечивает два из следующих 3 свойств:
  1. согласованных данных
  2. доступность
  3. устойчивость к разделению

Отбрасывать третье свойство в распределённых системах как правило, ибо на практике трудно полностью избежать потери сообщений или обрыва соединения между серверами.

При выборе приоритетов среди вышеуказанных свойств следует принять во внимание обобенности проектируеммого сервиса:
  1. Объём запросов на запись ограничен числом матчей и следовательно небольшой (изменять матчи могут только пользователи со специальными привилегиями), но при этом важно доступность записи в любой момент.
  2. Объём запросов на чтение может быть сколь угодно большим.
  3. Сервис носит информационный характер. Его доступность должна быть более приоритетной, чкм актуальность получаемых ответов на запросы.
  4. Общий обЬём хранящихся данных невелик.

Исходя из вышеприведённых особенностей, можно определить следующие параметры распределённой системы хранения данных:
  1. N - количество узлов, хранящих копии (реплики) данных;
  2. W - количество реплик, которые должны подтвердить получение обновления, прежде чем обновление считается завершенным;
  3. R - количество реплик, с которыми устанавливается связь при обработке запроса на чтение данных.
  
  В связи с пердполагаемой высокой нагрузкой на чтение, число N узлов должно быть достаточным большим, чтобы иметь возможность бесперебойно обрабатывать запросы. При этом в целях обеспечения надёжности хранения N должно быть не менее 2.
  Также из-за высокой нагрузки занчение R предпочтительнее всего установить равным единице.
  В этом случае для обеспечения сильной согласованности значение W должно быть равно N. Но в таком случае выход из строя хотя бы одного из узлов приведёт к невозможности записи, что неприемлемо. С другой стороны, установка W=1 может сделать изменения уязвимыми к сбоям узлов. Следовательно, наибольее разумным вариантов выглядит W=2.
  
  В реззультате упор при проектировании распределённой системы будет сделан в сторону доступности (AP), с обеспечением eventual consistency. При возникновении конфликтов при слиянии приоритет будет отдаваться данным с более поздим timestamp.

Для реализации системы хранения подобного рода можно использовать СУБД Cassandra. 
